@page
@model PRN221.Team5.Web.Pages.Dashboard.ManageNews
@{
    ViewData["Title"] = "ManageNews";
}


<div x-data="{'add':false, 'edit': false, 'remove': false }" x-init="dataTable = $('#table_news').DataTable({
    'lengthMenu': [[5, 10, 15, -1], [5, 10, 15, 'All']],
    'responsive': true,
    'ordering': false,
})">

    <div class="mx-auto p-4 md:p-6 2xl:p-10">
        

        <div class="rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1">

            <div class="flex w-full justify-between my-4">
                <h3 class="mb-6 text-xl font-bold text-black dark:text-white">
                    All Posts
                </h3>
                <div class="flex flex-row gap-2">
                    <button id="add-post-btn" onclick="add_post_modal.showModal()"
                            class="rounded-xl inline-flex items-center justify-center gap-2.5 bg-primary h-fit py-3 px-6 text-center text-sm font-medium text-white hover:bg-opacity-90 ">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24"
                                 width="18" fill="#fff" height="18">
                                <path d="M17,12c0,.553-.448,1-1,1h-3v3c0,.553-.448,1-1,1s-1-.447-1-1v-3h-3c-.552,0-1-.447-1-1s.448-1,1-1h3v-3c0-.553,.448-1,1-1s1,.447,1,1v3h3c.552,0,1,.447,1,1Zm7-7v14c0,2.757-2.243,5-5,5H5c-2.757,0-5-2.243-5-5V5C0,2.243,2.243,0,5,0h14c2.757,0,5,2.243,5,5Zm-2,0c0-1.654-1.346-3-3-3H5c-1.654,0-3,1.346-3,3v14c0,1.654,1.346,3,3,3h14c1.654,0,3-1.346,3-3V5Z" />
                            </svg>

                        </span>
                        Add New
                    </button>
                    @*<button id="view-detail-post-btn" onclick="view-detail_post_modal.showModal()"
                            class="disabled:bg-graydark/20 rounded-xl inline-flex items-center justify-center gap-2.5 bg-primary h-fit py-3 px-6 text-center text-sm font-medium text-white hover:bg-opacity-90 ">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24"
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25M16.5 7.5V18a2.25 2.25 0 002.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 002.25 2.25h13.5M6 7.5h3v3H6v-3z" />
                            </svg>

                        </span>
                        View Detail
                    </button>*@
                    <button id="edit-post-btn" onclick="edit_post_modal.showModal()"
                            class="disabled:bg-graydark/20 disabled:text-graydark/30 rounded-xl inline-flex items-center justify-center gap-2.5 bg-graydark/40 h-fit py-3 px-6 text-center text-sm font-medium text-white hover:bg-opacity-90 ">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" id="Outline" viewBox="0 0 24 24" width="18"
                                 height="18" class="fill-current">
                                <path d="M18.656.93,6.464,13.122A4.966,4.966,0,0,0,5,16.657V18a1,1,0,0,0,1,1H7.343a4.966,4.966,0,0,0,3.535-1.464L23.07,5.344a3.125,3.125,0,0,0,0-4.414A3.194,3.194,0,0,0,18.656.93Zm3,3L9.464,16.122A3.02,3.02,0,0,1,7.343,17H7v-.343a3.02,3.02,0,0,1,.878-2.121L20.07,2.344a1.148,1.148,0,0,1,1.586,0A1.123,1.123,0,0,1,21.656,3.93Z" />
                                <path d="M23,8.979a1,1,0,0,0-1,1V15H18a3,3,0,0,0-3,3v4H5a3,3,0,0,1-3-3V5A3,3,0,0,1,5,2h9.042a1,1,0,0,0,0-2H5A5.006,5.006,0,0,0,0,5V19a5.006,5.006,0,0,0,5,5H16.343a4.968,4.968,0,0,0,3.536-1.464l2.656-2.658A4.968,4.968,0,0,0,24,16.343V9.979A1,1,0,0,0,23,8.979ZM18.465,21.122a2.975,2.975,0,0,1-1.465.8V18a1,1,0,0,1,1-1h3.925a3.016,3.016,0,0,1-.8,1.464Z" />
                            </svg>


                        </span>
                        Edit
                    </button>
                    <button id="remove-post-btn" onclick="remove_post_modal.showModal()"
                            class="disabled:bg-graydark/20 disabled:text-graydark/30 rounded-xl inline-flex items-center justify-center gap-2.5 bg-danger/20 h-fit py-3 px-6 text-center text-sm font-medium text-danger hover:bg-opacity-90 ">
                        <span>
                            <svg class="fill-current" xmlns="http://www.w3.org/2000/svg" id="Outline"
                                 viewBox="0 0 24 24" width="18" height="18">
                                <path d="M21,4H17.9A5.009,5.009,0,0,0,13,0H11A5.009,5.009,0,0,0,6.1,4H3A1,1,0,0,0,3,6H4V19a5.006,5.006,0,0,0,5,5h6a5.006,5.006,0,0,0,5-5V6h1a1,1,0,0,0,0-2ZM11,2h2a3.006,3.006,0,0,1,2.829,2H8.171A3.006,3.006,0,0,1,11,2Zm7,17a3,3,0,0,1-3,3H9a3,3,0,0,1-3-3V6H18Z" />
                                <path d="M10,18a1,1,0,0,0,1-1V11a1,1,0,0,0-2,0v6A1,1,0,0,0,10,18Z" />
                                <path d="M14,18a1,1,0,0,0,1-1V11a1,1,0,0,0-2,0v6A1,1,0,0,0,14,18Z" />
                            </svg>
                        </span>
                        Remove
                    </button>


                </div>
            </div>

            <table id="table_news" class="w-full table-fixed">
                <thead>
                    <tr class="bg-gray-2 text-left dark:bg-meta-4">
                        <th class="w-0 font-medium text-black dark:text-white xl:pl-11 collapse">
                            Id
                        </th>
                        <th class="w-[30px] font-medium text-black dark:text-white text-center">
                            #
                        </th>
                        <th class="w-[200px] font-medium text-black dark:text-white xl:pl-11">
                            Title
                        </th>
                        <th class="w-max font-medium text-black dark:text-white xl:pl-11">
                            Content
                        </th>
                        <th class="w-[200px] font-medium text-black dark:text-white text-center">
                            Create date
                        </th>
                        <th class="w-[200px] font-medium text-black dark:text-white text-center">
                            Update date
                        </th>
                    </tr>
                </thead>
              @*//     ┓ ┓
                //  ╋┏┓┣┓┃┏┓  ┏┓┏┓┓┏┏┏
                //  ┗┗┻┗┛┗┗   ┛┗┗ ┗┻┛┛
                //
                *@
                <tbody>
                    @foreach (var newItem in Model.News.Select((value, i) => new { i, value }))
                    {
                        <tr x-data="{ postStatus: '{{ post.Status }}' }" class="hover:bg-gray-3 dark:hover:bg-meta-4">
                            <td class="border-b border-[#eee] py-5 px-4 pl-9 dark:border-strokedark xl:pl-11 collapse">
                                <p class="text-black dark:text-white line-clamp-1  ">
                                    @newItem.value.Id
                                </p>
                            </td>
                            <td class="border-b border-[#eee] py-5 px-4 pl-9 dark:border-strokedark xl:pl-11">
                                <p class="text-black dark:text-white line-clamp-1  ">
                                    #@(newItem.i + 1)
                                </p>
                            </td>
                            <td class="border-b border-[#eee] py-5 px-4 pl-9 dark:border-strokedark xl:pl-11">
                                <p class="text-black dark:text-white line-clamp-1  ">
                                    @newItem.value.Title
                                </p>
                            </td>
                            <td class="border-b border-[#eee] py-5 px-4 pl-9 dark:border-strokedark xl:pl-11">
                                <p class="text-black dark:text-white line-clamp-3 text-left ">
                                    @newItem.value.Content
                                </p>
                            </td>
                            <td class=" border-b border-[#eee] py-5 px-4 dark:border-strokedark">
                                <p class="line-clamp-1 text-black dark:text-white text-center">@newItem.value.CreatedDate</p>
                            </td>
                            <td class="border-b border-[#eee] py-5 px-4 dark:border-strokedark">
                                <p class="line-clamp-1 text-black dark:text-white text-center">@newItem.value.UpdatedDate</p>
                            </td>
                        </tr>
                    }

                </tbody>
            </table>
        </div>

    </div>
    <!-- Add New Modal -->
    @await Html.PartialAsync("../Shared/Partials/Modal/News/_ModalAddPost.cshtml")

    <!-- Edit New Modal -->
    @await Html.PartialAsync("../Shared/Partials/Modal/News/_ModalEditPost.cshtml")

    <!-- Remove New Modal -->
    @await Html.PartialAsync("../Shared/Partials/Modal/News/_ModalRemovePost.cshtml")

</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get the DataTable instance
        const table = dataTable;
        let selectedRow = null; // Store the selected row
        let rowData = null;

        table.on('click', 'tbody tr', function () {
            const row = $(this);
            console.log(table.row(this).data());

            if (selectedRow !== null) {
                selectedRow.removeClass('selected');
            }


            if (!row.hasClass('selected')) {
                row.addClass('selected');
                selectedRow = row; // Update the selected row
            } else {
                selectedRow = null; // Deselect the current row
            }
            updateButtonState();
        });


        function updateButtonState() {
            const editButton = document.getElementById('edit-post-btn');
            //const viewDetailButton = document.getElementById('view-detail-post-btn');
            const deleteButton = document.getElementById('remove-post-btn');

            if (selectedRow !== null) {
                editButton.removeAttribute('disabled'); // Enable the button
                // viewDetailButton.removeAttribute('disabled')
                deleteButton.removeAttribute('disabled')
            } else {
                editButton.setAttribute('disabled', 'disabled'); // Disable the button
                //viewDetailButton.setAttribute('disabled', 'disabled');  Disable the button
                deleteButton.setAttribute('disabled', 'disabled'); // Disable the button
            }
        }

        const editButton = document.getElementById("edit-post-btn");
        const editTitle = document.getElementById("edit-title");
        const editI = document.getElementById("edit-i");
        const editContent = document.getElementById("edit-content");
        const editCreatedDate = document.getElementById("edit-created-date");
        const editUpdatedDate = document.getElementById("edit-updated-date");
        const editId = document.getElementById("edit-id");
        editButton.addEventListener("click", function () {
            editId.value = $(table.row(selectedRow).data()[0]).text().trim();
            editI.textContent = "Edit Post" + $(table.row(selectedRow).data()[1]).text().trim();
            editTitle.value = $(table.row(selectedRow).data()[2]).text().trim();
            editContent.value = $(table.row(selectedRow).data()[3]).text().trim();
            editCreatedDate.value = $(table.row(selectedRow).data()[4]).text().trim();
            editUpdatedDate.value = $(table.row(selectedRow).data()[5]).text().trim();
        });

        const deleteButton = document.getElementById("remove-post-btn");
        const deleteId = document.getElementById("delete-id");
        deleteButton.addEventListener("click", function () {
            deleteId.value = $(table.row(selectedRow).data()[0]).text().trim();
        });


        // Initially, set the button state based on the selectedRow
        updateButtonState();
    });

</script>